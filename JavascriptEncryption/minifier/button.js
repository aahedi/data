var Try={these:function(){for(var e,t=0,n=arguments.length;n>t;t++){var r=arguments[t];try{e=r();break}catch(o){}}return e}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},request:function(e,t,n){var r=this.getTransport();if(r){if(null!==t&&"function"==typeof t)t.onSuccess=t;else if(!t.onSuccess)return!1;var o=n?"post":t.method?t.method:"get";if(r.open(o,e,!0),r.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest"),t.headers)for(header in t.headers)r.setRequestHeader("X-"+header,t.headers[header]);if("post"==o&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){return 4==r.readyState?200!=r.status&&304!=r.status?void(t.onFailure&&t.onFailure(r.status,r.responseText)):void t.onSuccess(r.responseText):void 0},4!=r.readyState)return r.send(n),!0}}},FlattrButton={doFlattr:function(e){var t={method:"post",onSuccess:function(){window.parent.postMessage(JSON.stringify({flattr_button_event:"click_successful"}),"*");var t=document.querySelector(".flattr-count span"),n=parseInt(t.innerHTML)||0;t.innerHTML=++n,e.className="flattr flattr-ed",e.querySelector("span.flattr-link").className="flattr-flattred";var r=e.href.match(/^(.+)\/flattr\/(.+)$/i);e.href=r[1]+"/subscribe/"+r[2],e.title="Subscribe"},onFailure:function(e,t){return window.useEvents||401!=e&&402!=e?401==e||402==e?void window.parent.postMessage(JSON.stringify({flattr_button_event:"unauthorized"}),"*"):void window.location.reload(!0):(t=JSON.parse(t),void(window.parent.location.href=t.url))}};Ajax.request(e.href,t)||window.location.reload(!0)},doSubscribe:function(e){var t={method:"post",onSuccess:function(){window.parent.postMessage(JSON.stringify({flattr_button_event:"subscribe_successful"}),"*");var t=document.createElement("span");t.className="flattr-subscribed";var n=document.createElement("span");n.className="flattr",n.appendChild(t),e.parentNode.replaceChild(n,e)},onFailure:function(){window.location.reload(!0)}};Ajax.request(e.href,t)},init:function(){if(!document.querySelectorAll){var e=document.getElementsByTagName("div")[0];return void e.parentNode.removeChild(e)}var t,n,r=document.querySelectorAll(".flattr");for(t=0,n=r.length;n>t;t++)r[t].onclick=function(){return/\bflattr-ajax\b/.test(this.className)?FlattrButton.doFlattr(this):/\bflattr-ed\b/.test(this.className)&&FlattrButton.doSubscribe(this),!1}}};window.onload=function(){FlattrButton.init()};